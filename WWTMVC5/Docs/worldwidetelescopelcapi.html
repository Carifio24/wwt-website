<HTML>

<head>
<title>WorldWide Telescope Planetarium</title>

 <link rel=stylesheet href="SDK_style.css" type="text/css" media=screen>

</head>

<body>

<style type="text/css">
#content .inner {
	margin: 10px 20px 10px 40px;
}
 .style1 {
	font-size: 10pt;
}
 </style>
<h1><a name="WorldWideTelescopeLooselyCoupledAPI"></a>WorldWide Telescope Loosely 
Coupled API (LCAPI)</h1>
<img alt="" height="27" src="//wwtweb.blob.core.windows.net/docs/uiimages/YesNo.bmp" width="220">
<p><font color="red">Note: This documentation is preliminary and subject to change.</font></p>
<p>This document describes how to write a software program to send data to 
WorldWide Telescope, using the Loosely Coupled API (LCAPI). For a large amount 
of data the program might be a tool that reads data from a spreadsheet file, and 
then sends 
the appropriate fields of the data to WorldWide Telescope in appropriately sized 
buffers for visualization. For a smaller amount of data the entire file could be 
loaded in one go, or images or 3D models could be loaded. Time series 
data would typically be time-and-location dependent event data such as:</p>
<ul>
	<li>Earthquakes</li>
	<li>Volcanic eruptions</li>
	<li>Disease outbreaks</li>
	<li>More general social or natural events and trends</li>
</ul>
<p>The time-series system does <em>not</em> lend itself to data that varies either its 
location or has a complex intensity - such as weather systems, or forest fires - though it is 
possible a limited approach to this sort of data may be useful. The system does 
lend itself to events that occur over an extended period of time, given the 
ability to greatly accelerate simulated time, and also events that decay very 
rapidly (lightning) or quite slowly (diseases) given the ability to control the 
decay time of the rendered graphic.</p>
<p>There are a number of constraints on the use of the LCAPI that should be 
understood before commencing with the design of the tool:</p>
<ul>
	<li>The data, typically spreadsheet data but also image and model data, must reside on the same computer 
	that WorldWide Telescope is being run on.</li>
	<li>The supported spreadsheet formats are comma or tab delimited files.</li>
	<li>The LCAPI is a feature of the Windows Client version of WorldWide 
	Telescope, not the Web Client.</li>
	<li>The LCAPI provides event, image or model data specifically to the Layer 
	Manager, not to any other component of WorldWide Telescope.</li>
</ul>
<div class="toc">
<h2>Table of Contents</h2>
<ul>
<li><a href="#Design Overview">Design Overview</a></li>
	<li><a href="#LCAPI_Commands">LCAPI Commands</a></li>
	<li><a href="#Utilities">Utilities</a></li>
	<li><a href="#Sample_Application">Sample Application</a></li>
</ul>
</div>
<h4>See Also</h4>
<p>For more information on WorldWide Telescope, refer to:</p>
<ul>
	<li><a href="worldwidetelescopeuserguide.html">WorldWide Telescope User Guide</a></li>
	<li><a href="worldwidetelescopedatafilesreference.html">WorldWide Telescope Data Files Reference</a></li>

</ul>
<hr>
<h2><a name="Design Overview">Design Overview</a></h2>
<p>The Windows client version of WorldWide Telescope listens for a certain 
format of communication from another application running on the same computer. 
The format of this communication is in the form of strings, that themselves are 
formatted in a specific way. An application may be quite short and only need a
<a href="#load"><strong>load</strong></a> call, or perhaps just 
need the <strong><a href="#new">new</a></strong> and <strong><a href="#update">update</a> </strong>
commands<strong>. </strong>Typically a simple application will go through the following steps, <em>after</em> 
WorldWide Telescope has been started:</p>
<ol>
	<li>Initialize and open a data file, or files, from a selected source.</li>
	<li>Initialize the connection with WorldWide Telescope with a <a href="#new">
	<strong>new</strong></a> or <strong><a href="#load">load</a></strong> call, which will create a new layer within 
	WorldWide Telescope, and return a layer Id number.</li>
	<li>If the <strong><a href="#new">new</a></strong> command is used:</li>
	<ol>
	<li>fill a string buffer with data from the opened files.</li>
	<li>Transmit the data to WorldWide Telescope with an <strong>
	<a href="#update">update</a></strong> call, using the layer Id number for 
	reference.</li>
	<li>Repeat steps 3 and 4 until all the data has been transmitted.</li></ol>
	<li>Close down.</li>
</ol>
<p>A more complex application may initialize several layers, or a layer group, within WorldWide 
Telescope, or may transmit the data under user control - enabling the user to 
have some choice over which data is rendered, the speed and time of the 
simulation, and other similar controls.</p>
<h3>Development Environment</h3>
<p>The samples and examples described in this document have been developed using 
Microsoft Visual Studio (2008 or 2010), and written in C#. In addition install 
the latest version of the .NET framework.</p>
<p>An alternative development environment is to write the code in Jscript using 
any text editor, and run it using Internet Explorer. </p>
<h4>See Also</h4>
<ul type="disc">
	<li><a href="#LCAPI_Commands">Layer API commands</a></li>
	<li><a href="#WorldWideTelescopeLooselyCoupledAPI">WorldWide Telescope 
	Loosely Coupled API</a></li>
</ul>

<hr>
<h2><a name="LCAPI_Commands">LCAPI Commands</a></h2>
<p>The following commands can be used to control layers from the application:</p>
<table class="T1" cellspacing="2" cellpadding="4">
<tr><td><h5>Command</h5></td><td><h5>Description</h5></td></tr>
<tr><td><strong><a href="#delete">delete</a></strong></td><td>Specifies that a layer should be 
		permanently deleted.</td></tr>
		<tr><td><b><a href="#group">group</a></b></td><td>Specifies that a layer group should be added.</td></tr>
<tr><td><a href="#load"><strong>load</strong></a></td><td>Specifies a data file, and and some optional parameters, to 
		apply to a new layer.</td></tr>
<tr><td><strong><a href="#new">new</a></strong></td><td>Specifies that a new layer should be 
	created.</td></tr>
<tr><td><strong><a href="#update">update</a></strong></td><td>Specifies that the data attached to this 
	command should be added to the layer.</td></tr>
</table>


<p>There are also a number of<a href="#Independent_Parameters"> Independent 
Parameters</a> that can be sent along with any of the commands listed above, or on their own.</p>
<h4>See Also</h4>
<ul type="disc">
	<li><a href="#WorldWideTelescopeLooselyCoupledAPI">WorldWide Telescope 
	Loosely Coupled API</a></li>
</ul>


<hr>
<h3><a name="delete"></a>delete</h3>
<p>The <strong>delete</strong> command specifies that a layer should be 
permanently deleted.</p>
<h4>Remarks</h4>
<p>All sub-components of the layer will also be deleted.<table class="T1" cellspacing="2" cellpadding="4">
<tr><td><h5>Required Parameter</h5></td><td><h5>Description</h5></td></tr>
<tr><td><strong>&amp;id</strong></td><td>Specifies the id number of the 
		layer.</td></tr>
</table>
</p>
<h4>Return Value</h4>
<p>The following string will be included in the response if the call is 
successful:</p>
<p><font COLOR="#a31515">&lt;Status&gt;Success&lt;/Status&gt;</font></p>
<p>The following string will be included in the response if the call is not 
successful:</p>
<font COLOR="#a31515">
<p>&lt;Status&gt;Error - Invalid layer ID&lt;/Status&gt;</p>
</font>

<h4>Example Code</h4>
<table class="T3" cellspacing="4" cellpadding="4">
<tr><td>
		<span style='font-size:10.0pt;font-family:"Courier New";'>

	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Send&nbsp;a 
		DELETE&nbsp;command</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WebClient&nbsp;client&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;WebClient(); <br />
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;url&nbsp;=&nbsp;<span style="color:blue;">string</span>.Format(<span style="color:#A31515;">&quot;http://{0}:5050/layerApi.aspx?cmd=delete&amp;id={1}&quot;</span>,&nbsp;GetIp().ToString(),&nbsp;layerId); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;response&nbsp;=&nbsp;client.UploadString(url,&nbsp;&quot;&quot;); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlDocument&nbsp;doc&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;XmlDocument(); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.LoadXml(response); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlNode&nbsp;node&nbsp;=&nbsp;doc[<span style="color:#A31515;">&quot;LayerApi&quot;</span>]; <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;s&nbsp;=&nbsp;node.InnerText; <br />
 <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Handle&nbsp;an&nbsp;error&nbsp;situation</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(s.Contains(<span style="color:#A31515;">&quot;Error&quot;</span>)) <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">throw</span>&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2B91AF;">Exception</span>(s); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
</span>
</td></tr>
</table>
<h4>See Also</h4>
<ul type="disc">
	<li><strong><a href="#load">load</a></strong></li>
	<li><strong><a href="#new">new</a></strong></li>
	<li><a href="#LCAPI_Commands">Layer API commands</a></li>
</ul>


<hr>
<h3><a name="group"></a>group</h3>
<p>The <strong>group</strong> command specifies that a layer group should be 
added.</p>
<h4>Remarks</h4>
<p>Layer groups are just an organizational aid when using the layer manager. The 
user will be able to collapse and expand groups in the Layer Manager, and have 
groups that are sub-sets of other groups.</p>
<p><table class="T1" cellspacing="2" cellpadding="4">
<tr><td><h5>Required Parameter</h5></td><td><h5>Description</h5></td></tr>
<tr><td><strong>&amp;name</strong></td><td>A unique name for the layer group.</td></tr>
<tr><td><strong>&amp;frame</strong></td><td>The reference frame of the group. This 
	can be an existing layer group name, or one of:<br><strong>Earth, Moon, Mercury, 
		Venus, Mars, Jupiter, Saturn, Uranus, Neptune, Pluto, Io, Ganymede, 
	Callisto, Europa.<br>Sun ?<br>ISS ?</strong></td></tr>
</table>
</p>
<h4>Return Value</h4>
<p>The following string will be included in the response if the call is 
successful:</p>
<p><font COLOR="#a31515">&lt;Status&gt;Success&lt;/Status&gt;</font></p>
<p>The following string will be included in the response if the call is not 
successful:</p>
<font COLOR="#a31515">
<p>&lt;Status&gt;Error - Invalid layer ID&lt;/Status&gt;</p>
</font>

<h4>Example Code</h4>
<table class="T3" cellspacing="4" cellpadding="4">
<tr><td>		<span style='font-size:10.0pt;font-family:"Courier New";'>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">void</span>&nbsp;createLayerGroup(<span style="color:blue;">string</span>&nbsp;frame,&nbsp;<span style="color:blue;">string</span>&nbsp;name) <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">try</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
 <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WebClient&nbsp;client&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;WebClient(); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;url&nbsp;=&nbsp;<span style="color:blue;">string</span>.Format(<span style="color:#A31515;">&quot;http://{0}:5050/layerApi.aspx?cmd=group&frame={1}&name={2}&quot;</span>,&nbsp;GetIp().ToString(),frame,name); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;response&nbsp;=&nbsp;client.UploadString(url,&nbsp;<span style="color:#A31515;">&quot;&quot;</span>); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlDocument&nbsp;doc&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;XmlDocument(); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.LoadXml(response); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlNode&nbsp;node&nbsp;=&nbsp;doc[<span style="color:#A31515;">&quot;LayerApi&quot;</span>]; <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;s&nbsp;=&nbsp;node.InnerText; <br />
 <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Handle&nbsp;an&nbsp;error&nbsp;situation</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(s.Contains(<span style="color:#A31515;">&quot;Error&quot;</span>)) <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">throw</span>&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2B91AF;">Exception</span>(s); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">catch</span>&nbsp;(<span style="color:#2B91AF;">Exception</span>&nbsp;ex) <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></td></tr>
</table>
<h4>See Also</h4>
<ul type="disc">
	<li><strong><a href="#load">load</a></strong></li>
	<li><strong><a href="#new">new</a></strong></li>
	<li><a href="#LCAPI_Commands">Layer API commands</a></li>
</ul>
<hr>
<h3><a name="load">load</a></h3>
<p>The <strong>load</strong> command specifies a data file, and and some optional parameters, to 
		apply to a new layer.</p>
<h4>Remarks</h4>
<p>Depending on the type of data loaded, the <strong>load</strong> command will 
initiate an import wizard of WorldWide Telescope, in order to select the 
appropriate columns, positional data, and so on. Note that parameter names are 
case-sensitive.</p>
<p><table class="T1" cellspacing="2" cellpadding="4">
<tr><td><h5>Required Parameter</h5></td><td><h5>Description</h5></td><td>&nbsp;</td></tr>
<tr><td><strong>&amp;frame</strong></td><td>The reference frame of the group. 
	This can be an existing layer group name, or one of:<br><strong>Earth, Moon, Mercury, 
		Venus, Mars, Jupiter, Saturn, Uranus, Neptune, Pluto, Io, Ganymede, 
	Callisto, Europa.<br>Sun ?<br>ISS ?</strong></td><td>&nbsp;</td></tr>
<tr><td><strong>&amp;filename</strong></td><td>The file to load. This can be a 
	spreadsheet data file, a 3D model (.3ds) file, or a WTML file containing an
	<strong>ImageSet</strong> reference. In the latter case the first image set 
	found in the file will be loaded. Refer to the
	<a href="http://www.worldwidetelescope.org/Docs/WorldWideTelescopeDataFilesReference.html">
	WorldWide Telescope Data Files Reference</a> for more details.</td><td>&nbsp;</td></tr>
<tr><td>
	<h5>Optional Parameter</h5>
	</td><td>&nbsp;</td><td>
	<h5>Default</h5>
	</td></tr>
	<tr>
		<td><strong>&amp;name</strong></td><td>A friendly name for the layer. </td><td>
		&quot;New Layer&quot;</td>
	</tr>
	<tr>
		<td><strong>&amp;color</strong></td><td>ARBG hex value of the color to be used 
	when rendering the events of the layer.</td><td>FFFFFFFF<br>(white)</td>
	</tr>
<tr><td><strong>&amp;beginDate</strong></td><td>With time series data, the date and 
	time to start the visualization. This could for example be slightly earlier 
	than the date of the first event in the actual data. For example:
		<font COLOR="#a31515">&quot;1/1/2000 12:30:30 AM&quot;</font>.</td><td>
	The System minimum date value</td></tr>
<tr><td><strong>&amp;endDate</strong></td><td>With time series data, the date and 
	time to end the visualization.</td><td>The System maximum date value</td></tr>
<tr><td><strong>&amp;fadeType</strong></td><td>Fades the data visualization. One of: <strong>In</strong>, <strong>
	Out</strong>, <strong>Both</strong> or <strong>None</strong>.</td><td>None</td></tr>
<tr><td><strong>&amp;fadeRange</strong></td><td>Fade time in days.</td><td>Zero</td></tr>
</table>
</p>
<h4>Return Value</h4>
<p>The following string will be included in the response string:</p>

<p><font COLOR="#a31515">&lt;LayerApi&gt;&lt;NewLayerID&gt;<em>nnnn</em>&lt;/NewLayerID&gt;&lt;/LayerApi&gt;</font></p>

<p>Where <em>nnnn</em> is the layer id number, which will be a GUID in string 
format.</p>
<p>The following string will be included in the response if the call is not 
successful:</p>
<font COLOR="#a31515">
<p>&lt;Status&gt;Error - Could not Load Layer&lt;/Status&gt;</p>
</font>

<h4>Example Code</h4>
<table class="T3" cellspacing="4" cellpadding="4">
<tr><td>
		<span style='font-size:10.0pt;font-family:"Courier New";'>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">void</span>&nbsp;loadDatafile(<span style="color:blue;">string</span>&nbsp;name,&nbsp;<span style="color:blue;">string</span>&nbsp;frame,&nbsp;<span style="color:blue;">string</span>&nbsp;filename,&nbsp;<span style="color:blue;">string</span>&nbsp;begindate) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">try</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
 	   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WebClient&nbsp;client&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;WebClient(); <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;url&nbsp;=&nbsp;<span style="color:blue;">string</span>.Format(<span style="color:#A31515;">&quot;http://{0}:5050/layerApi.aspx?cmd=load&frame={1}&filename={2}&name={3}&beginDate={4}&quot;</span>,&nbsp;GetIp().ToString(),&nbsp;frame,&nbsp;filename,&nbsp;name,&nbsp;begindate); <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;response&nbsp;=&nbsp;client.UploadString(url,&nbsp;<span style="color:#A31515;">&quot;&quot;</span>); <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlDocument&nbsp;doc&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;XmlDocument(); <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.LoadXml(response); <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlNode&nbsp;node&nbsp;=&nbsp;doc[<span style="color:#A31515;">&quot;LayerApi&quot;</span>]; <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;s&nbsp;=&nbsp;node.InnerText; <br />
 <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Handle&nbsp;an&nbsp;error&nbsp;situation</span> <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(s.Contains(<span style="color:#A31515;">&quot;Error&quot;</span>)) <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">throw</span>&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2B91AF;">Exception</span>(s); <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">catch</span>&nbsp;(<span style="color:#2B91AF;">Exception</span>&nbsp;ex) <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></td></tr>
</table>
<h4>See Also</h4>
<ul type="disc">
	<li><strong><a href="#group">group</a></strong></li>
	<li><a href="#Independent_Parameters">Independent Parameters</a></li>
	<li><strong><a href="#new">new</a></strong></li>
	<li><strong><a href="#update">update</a></strong></li>
	<li><a href="#LCAPI_Commands">Layer API commands</a></li>
</ul>


<hr>
<h3><a name="new"></a>new</h3>
<p>The <b>new</b> command specifies that a new layer should be created.</p>
<h4>Remarks</h4>
<p>The <strong>new</strong> command will request that an entirely new layer be 
created, with the following parameters (note that the parameter names are case-sensitive):</p>
<table class="T1" cellspacing="2" cellpadding="4">
<tr><td>
	<h5>Required<br>Parameter</h5>
	</td><td>
	<h5>Description</h5>
	</td><td>
	&nbsp;</td></tr>
<tr><td>
	<strong>&amp;frame</strong></td><td>The reference frame of the 
		layer. This can be one of:<br><strong>Earth, Moon, Mercury, 
		Venus, Mars, Jupiter, Saturn, Uranus, Neptune, Pluto, Io, Ganymede, 
	Callisto, Europa.<br>Sun ?<br>ISS ?</strong></td><td>
	&nbsp;</td></tr>
<tr><td>
	<h5>Optional Parameters</h5>
	</td><td><h5>&nbsp;</h5></td><td>
	<h5>Default</h5>
	</td></tr>
	<tr>
		<td><strong>&amp;name</strong></td><td>A friendly name for the layer. </td><td>
		&quot;New Layer&quot;</td>
	</tr>
	<tr>
		<td><strong>&amp;color</strong></td><td>ARBG hex value of the color to be used 
	when rendering the events of the layer.</td><td>FFFFFFFF<br>(white)</td>
	</tr>
	<tr>
		<td><strong>&amp;beginDate</strong></td><td>With time series data, the date 
		and time to start the visualization. This could for example be slightly 
		earlier than the date of the first event in the actual data. For 
		example:
		<font COLOR="#a31515">&quot;1/1/2000 12:30:30 AM&quot;</font>.</td><td>
		The System minimum date value</td>
	</tr>
	<tr>
		<td><strong>&amp;endDate</strong></td><td>With time series data, the date 
		and time to end the visualization.</td><td>The System maximum date value</td>
	</tr>
	<tr>
		<td><strong>&amp;fadeType</strong></td><td>Fades the data visualization. One of: <strong>In</strong>,
		<strong>Out</strong>, <strong>Both</strong> or <strong>None</strong>.</td><td>
		None</td>
	</tr>
	<tr>
		<td><strong>&amp;fadeRange</strong></td><td>Fade time in days.</td><td>Zero</td>
	</tr>
</table>
<p>The <strong>new</strong> command is embedded in a formatted string (see the
<strong>Example Code)</strong>. This formatted string forms the first of two 
parameters to the <strong>WebClient</strong> <strong>UploadString</strong> 
method.</p>
<p>The second string parameter to <strong>UploadString</strong> should contain a 
comma or tab delimited string containing the heading names of the columns in the 
layer. The supported column names are listed in the following table. The names 
of the columns in the data file must <em>contain</em> the names listed here (so
<strong>&quot;Latitude&quot;</strong> is acceptable for <strong>&quot;Lat&quot;</strong>, or &quot;<strong>dX</strong>&quot; 
acceptable for &quot;<strong>X</strong>&quot;, for example).</p>
<table class="T1" cellspacing="2" cellpadding="4">
<tr><td class="style1">
	<strong>Column Heading</strong></td><td><h5>Description</h5></td></tr>
	<tr>
		<td><strong>Time</strong></td><td>UTC time, for example:
		<font COLOR="#a31515">&quot;1/1/2000 12:02:46 AM&quot;</font></td>
	</tr>
	<tr>
		<td><strong>Lat</strong></td><td>Latitude in decimal degrees.</td>
	</tr>
	<tr>
		<td><strong>Lon</strong></td><td>Longitude in decimal degrees.</td>
	</tr>
	<tr>
		<td><strong>RA</strong></td><td>Right ascension in decimal degrees.</td>
	</tr>
	<tr>
		<td><strong>Dec</strong></td><td>Declination in decimal degrees.</td>
	</tr>
	<tr>
		<td><strong>Depth</strong></td><td>Depth in kilometers.</td>
	</tr>
	<tr>
		<td><strong>Altitude</strong></td><td>Altitude in meters.</td>
	</tr>
<tr><td><strong>Mag</strong></td><td>Magnitude as a floating point number.</td></tr>
</table>
<h4>Return Value</h4>
<p>The following string will be included in the response string:</p>

<p><font COLOR="#a31515">&lt;LayerApi&gt;&lt;NewLayerID&gt;<em>nnnn</em>&lt;/NewLayerID&gt;&lt;/LayerApi&gt;</font></p>

<p>Where <em>nnnn</em> is the layer id number, which will be a GUID in string 
format. If a GUID is not received, then the call was 
not successful.</p>
<h4>Example Code</h4>
<table class="T3" cellspacing="4" cellpadding="4">
<tr><td>
		<span style='font-size:10.0pt;font-family:"Courier New";'>
		&nbsp;<span style="color:green;">&nbsp; //</span> <br />
&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Send&nbsp;a&nbsp;NEW&nbsp;command,&nbsp;extracting&nbsp;info&nbsp;from&nbsp;the&nbsp;data&nbsp;file&nbsp;and&nbsp;the&nbsp;UI</span> <br />
&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;WebClient&nbsp;client&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;WebClient(); <br />
&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;startDate&nbsp;=&nbsp;
		<font COLOR="#a31515">&quot;1/1/2009 12:00:00 AM&quot;</font>; <br />
&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;name&nbsp;=&nbsp;<font COLOR="#a31515">&quot;Earthquakes 
		2009&quot;</font>; <br />
&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;rate&nbsp;=&nbsp;<font COLOR="#a31515">&quot;10000&quot;</font>; <br />
&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;frame&nbsp;=&nbsp;<font COLOR="#a31515">&quot;Earth&quot;</font>; <br />
&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;color&nbsp;=&nbsp;<font COLOR="#a31515">&quot;FFFF0000&quot;</font>; <br />
 <br />
&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;url&nbsp;=&nbsp;<span style="color:blue;">string</span>.Format(<span style="color:#A31515;">&quot;http://{0}:5050/layerApi.aspx?cmd=new&amp;datetime={1}&amp;timerate={2}&amp;name={3}&amp;frame={4}&amp;color={5}&quot;</span>,&nbsp;&nbsp;GetIp().ToString(),&nbsp;startDate,&nbsp;rate,&nbsp;name,&nbsp;frame,&nbsp;color);
		<br> <br />
&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;field&nbsp;string&nbsp;below&nbsp;is&nbsp;delimited&nbsp;by&nbsp;tabs,&nbsp;not 
	spaces</span><br />
&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;response&nbsp;=&nbsp;client.UploadString(url,&nbsp;<span style="color:#A31515;">&quot;TIME&nbsp;&nbsp;&nbsp;&nbsp;LAT&nbsp;&nbsp;&nbsp;&nbsp;LON&nbsp;&nbsp;&nbsp;&nbsp;DEPTH&nbsp;&nbsp;&nbsp;&nbsp;MAG&quot;</span>); <br />
&nbsp;&nbsp;&nbsp;XmlDocument&nbsp;doc&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;XmlDocument(); <br />
&nbsp;&nbsp;&nbsp;doc.LoadXml(response); <br />
&nbsp;&nbsp;&nbsp;XmlNode&nbsp;node&nbsp;=&nbsp;doc[<span style="color:#A31515;">&quot;LayerApi&quot;</span>]; <br />
&nbsp;&nbsp;&nbsp;XmlNode&nbsp;child&nbsp;=&nbsp;node.ChildNodes[0]; <br />
&nbsp;&nbsp;&nbsp;layerId&nbsp;=&nbsp;child.InnerText; <br />
 <br />
&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Handle&nbsp;an&nbsp;error&nbsp;situation</span> <br />
&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(layerId.Length&nbsp;!=&nbsp;36) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">throw</span>&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2B91AF;">Exception</span>(<span style="color:#A31515;">&quot;Invalid&nbsp;Layer&nbsp;Id&nbsp;received&quot;</span>); <br />
 <br />
&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> 
		</span>
	</td></tr>
</table>
<p>For an example of the use of this command in the sample application, see
<a href="#initWWTLayer">initWWTLayer</a>.</p>
<h4>See Also</h4>
<ul type="disc">
	<li><strong><a href="#delete">delete</a></strong></li>
	<li><strong><a href="#GetIp">GetIp</a></strong></li>
	<li><strong><a href="#group">group</a></strong></li>
	<li><a href="#Independent_Parameters">Independent Parameters</a></li>
	<li><strong><a href="#load">load</a></strong></li>
	<li><strong><a href="#update">update</a></strong></li>
	<li><a href="#LCAPI_Commands">Layer API commands</a></li>
</ul>


<hr>
<h3><a name="update"></a>update</h3>
<p>The <strong>update</strong> command specifies that the data attached to this 
command should be added to the layer.</p>
<h4>Remarks</h4>
<p>The <strong>update</strong> command will request that data for a layer be 
updated, with the following parameters (note that the parameter names are case-sensitive):</p>
<table class="T1" cellspacing="2" cellpadding="4">
<tr><td><h5>Required Parameter</h5></td><td><h5>Description</h5></td><td>
	<h5>&nbsp;</h5>
	</td></tr>
<tr><td><strong>&amp;id</strong></td><td>Specifies the id number of the layer.</td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>
	<h5>Optional Parameters</h5>
	</td><td>
	<h5>Description</h5>
	</td><td>
	<h5>Default</h5>
	</td></tr>
	<tr>
		<td><strong>&amp;name</strong></td><td>A friendly name to rename the 
		layer. </td><td>
		No change</td>
	</tr>
<tr><td><strong>&amp;noPurge</strong></td><td>The sending of an update command will 
	delete events that occur before the start time of any events in the update 
	and that have already decayed. Set this flag to true if the event data 
	should not be deleted.</td><td>False</td></tr>
<tr><td><strong>&amp;show</strong></td><td>Set to <strong>true</strong> to show the layer, 
	<strong>false</strong> 
	to hide it. True and false are not case-sensitive.</td><td>True</td></tr>
</table>
<p>The second string parameter to <strong>UploadString</strong> should contain a 
comma or tab delimited string containing the data in a form that matches the 
heading names of the columns in the layer provided in the <strong><a href="#new">new</a> </strong>
command.</p>
<h4>Return Value</h4>
<p>The following string will be included in the response if the call is 
successful:</p>
<p><font COLOR="#a31515">&lt;Status&gt;Success&lt;/Status&gt;</font></p>
<p>The following string will be included in the response if the call is not 
successful:</p>
<font COLOR="#a31515">
<p>&lt;Status&gt;Error - Invalid layer ID&lt;/Status&gt;</p>
</font>

<h4>Example Code</h4>
<table class="T3" cellspacing="4" cellpadding="4">
<tr><td>	<span style='font-size:10.0pt;font-family:"Courier New";'>

	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Send&nbsp;an&nbsp;UPDATE&nbsp;command</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WebClient&nbsp;client&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;WebClient(); <br />
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;url&nbsp;=&nbsp;<span style="color:blue;">string</span>.Format(<span style="color:#A31515;">&quot;http://{0}:5050/layerApi.aspx?cmd=update&amp;id={1}&quot;</span>,&nbsp;GetIp().ToString(),&nbsp;layerId); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;response&nbsp;=&nbsp;client.UploadString(url,&nbsp;lineBuffer); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlDocument&nbsp;doc&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;XmlDocument(); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.LoadXml(response); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlNode&nbsp;node&nbsp;=&nbsp;doc[<span style="color:#A31515;">&quot;LayerApi&quot;</span>]; <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;s&nbsp;=&nbsp;node.InnerText; <br />
 <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Handle&nbsp;an&nbsp;error&nbsp;situation</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(s.Contains(<span style="color:#A31515;">&quot;Error&quot;</span>)) <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">throw</span>&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2B91AF;">Exception</span>(s); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br><br>
	
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Send&nbsp;an&nbsp;UPDATE&nbsp;command 
	with a flyTo parameter</span><br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> 
	<br>	<span style='font-size:10.0pt;font-family:"Courier New";'>

	<span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string</span>&nbsp;lat, 
	lon, zoom, rotation, angle;<br>

	
	
</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WebClient&nbsp;client&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;WebClient(); <br />
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;url&nbsp;=&nbsp;<span style="color:blue;">string</span>.Format(<span style="color:#A31515;">&quot;http://{0}:5050/layerApi.aspx?cmd=update&amp;id={1}&amp;flyTo={2},{3},{4},{5},{6}&amp;instant=True&quot;</span>,&nbsp;GetIp().ToString(),&nbsp;layerId, 
	lat, lon, zoom, rotation, angle); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;response&nbsp;=&nbsp;client.UploadString(url,&nbsp;lineBuffer); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlDocument&nbsp;doc&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;XmlDocument(); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.LoadXml(response); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlNode&nbsp;node&nbsp;=&nbsp;doc[<span style="color:#A31515;">&quot;LayerApi&quot;</span>]; <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;s&nbsp;=&nbsp;node.InnerText; <br />
 <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Handle&nbsp;an&nbsp;error&nbsp;situation</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(s.Contains(<span style="color:#A31515;">&quot;Error&quot;</span>)) <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">throw</span>&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2B91AF;">Exception</span>(s); <br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}

	
	
</span>
	</td></tr>
</table>
<p>For an example of the use of this command in the sample application, see
<a href="#flushBufferToWWT">flushBufferToWWT</a>.</p>
	<h4>See Also</h4>
<ul type="disc">
	<li><a href="#GetIp"><strong>GetIp</strong></a></li>
	<li><a href="#Independent_Parameters">Independent Parameters</a></li>
	<li><strong><a href="#new">new</a></strong></li>
	<li><strong><a href="#load">load</a></strong></li>
	<li><a href="#LCAPI_Commands">Layer API commands</a></li>
</ul>
<hr>
<h3><a name="Independent_Parameters">Independent Parameters</a></h3>
<p>The following parameters can be included with any of the&nbsp; <a href="#LCAPI_Commands">Layer API commands</a>, 
or sent on their own without a command.<br></p>
<table class="T1" cellspacing="2" cellpadding="4">
<tr><td>
	<h5>Parameter</h5>
	</td><td>
	<h5>Description</h5>
	</td></tr>
	<tr>
		<td><strong>&amp;datetime</strong></td><td>The starting date and time 
		for the visualization, in UTC format, for example:
		<font COLOR="#a31515">&quot;1/1/2000 12:02:46 AM&quot;</font>.</td>
	</tr>
	<tr>
		<td><strong>&amp;timerate</strong></td><td>The accelerated time to render the 
		visualization, as a multiple of 10.</td>
	</tr>
<tr><td><strong>&amp;flyTo</strong></td><td>Sets the position of the view 
	camera. Requires five floating point numbers separated by commas: latitude, 
	longitude, zoom level, rotation and angle.<br>
	<ul>
	<li>Latitude is in decimal degrees, positive to the North.</li>
	<li>Longitude is in decimal degrees, positive to the East.</li>
	<li>Zoom level varies from 360 (the most distant view) to 0.00023 (the closest view).</li>
	<li>Rotation is in radians, positive moves the camera to the left.</li>
	<li>Angle is in radians, positive moves the camera forward.</li>
	</ul>
</td></tr>
<tr><td><strong>&amp;instant</strong></td><td>Used with the <strong>&amp;flyTo</strong> parameter, set this to 
	<strong>true</strong> to specify that the camera should jump to the location, or 
	<strong>false</strong> that 
	the camera should smoothly pan and zoom to the location.</td></tr>
</table>
	<h4>See Also</h4>
<ul type="disc">
	<li><strong><a href="#new">new</a></strong></li>
	<li><strong><a href="#load">load</a></strong></li>
	<li><a href="#LCAPI_Commands">Layer API commands</a></li>
	<li><a href="#WorldWideTelescopeLooselyCoupledAPI">WorldWide Telescope 
	Loosely Coupled API</a></li>
</ul>
<hr>
<h2><a name="Utilities">Utilities</a></h2>
<p>The following utilities are not part of the API, but should be useful in 
building an application.</p>
<ul>
	<li><a href="#GetIp"><strong>GetIp</strong></a></li>
</ul>
<h4>See Also</h4>
<ul type="disc">
	<li><a href="#LCAPI_Commands">Layer API commands</a></li>
	<li><a href="#WorldWideTelescopeLooselyCoupledAPI">WorldWide Telescope 
	Loosely Coupled API</a></li>
</ul>


<hr>
<h3><a name="GetIp">GetIp</a></h3>
<p>The IP address of your application is critical in the communication with 
WorldWide Telescope. The following utility will extract this address.</p>
<table class="T3" cellspacing="4" cellpadding="4">
<tr><td>
	<span style='font-size:10.0pt;font-family:"Courier New";'>
	&nbsp;&nbsp;IPAddress&nbsp;GetIp() <br />
&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPAddress&nbsp;ipAddress&nbsp;=&nbsp;IPAddress.Loopback; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Find&nbsp;IPV4&nbsp;Address</span> <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">foreach</span>&nbsp;(IPAddress&nbsp;ipAdd&nbsp;<span style="color:blue;">in</span>&nbsp;Dns.GetHostEntry(Dns.GetHostName()).AddressList) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(ipAdd.AddressFamily&nbsp;==&nbsp;AddressFamily.InterNetwork) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipAddress&nbsp;=&nbsp;ipAdd; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">break</span>; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;ipAddress; <br />
&nbsp;&nbsp;}</span></td></tr>
</table>
<h4>See Also</h4>
<ul type="disc">
	<li><strong><a href="#update">update</a></strong></li>
	<li><strong><a href="#new">new</a></strong></li>
	<li><a href="#LCAPI_Commands">Layer API commands</a></li>
</ul>


<hr>
<h2><a name="Sample_Application">Sample Application</a></h2>
<p>The following sample application loads earthquake data from a CSV file, sends 
it in buffers of up to 100 events, and 
displays it as a time series in WorldWide Telescope.</p>
<table class="T1" cellpadding="4" cellspacing="4">
<tr><td>


	<img alt="" height="658" src="//wwtweb.blob.core.windows.net/docs/images/LCAPI_sample.jpg" width="902"></td></tr>
	<tr><td>
	
		<img alt="" height="580" src="//wwtweb.blob.core.windows.net/docs/images/LCAPI_quakes.jpg" width="960"></td></tr>
</table>

<p>&nbsp;</p>
<table class="T3" cellspacing="8" cellpadding="8">
<tr><td><h5>Form1.cs</h5></td></tr>
<tr><td><span style='font-size:10.0pt;font-family:"Courier New";'>
<span style="color:blue;">using</span>&nbsp;System; <br />
<span style="color:blue;">using</span>&nbsp;System.Collections.Generic; <br />
<span style="color:blue;">using</span>&nbsp;System.ComponentModel; <br />
<span style="color:blue;">using</span>&nbsp;System.Data; <br />
<span style="color:blue;">using</span>&nbsp;System.Drawing; <br />
<span style="color:blue;">using</span>&nbsp;System.Linq; <br />
<span style="color:blue;">using</span>&nbsp;System.Text; <br />
<span style="color:blue;">using</span>&nbsp;System.Windows.Forms; <br />
 <br />
<span style="color:green;">//</span> <br />
<span style="color:green;">//&nbsp;Added&nbsp;References</span> <br />
<span style="color:green;">//</span> <br />
<span style="color:blue;">using</span>&nbsp;System.IO; <br />
<span style="color:blue;">using</span>&nbsp;System.Net; <br />
<span style="color:blue;">using</span>&nbsp;System.Net.Sockets; <br />
<span style="color:blue;">using</span>&nbsp;System.Xml; <br />
 <br />
<span style="color:green;">//</span> <br />
<span style="color:green;">//&nbsp;&nbsp;Quakes&nbsp;is&nbsp;a&nbsp;sample&nbsp;of&nbsp;the&nbsp;WorldWide&nbsp;Telescope&nbsp;LCAPI</span> <br />
<span style="color:green;">//&nbsp; </span> <br />
 <br />
<span style="color:blue;">namespace</span>&nbsp;Quakes <br />
{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">partial</span>&nbsp;<span style="color:blue;">class</span>&nbsp;Quakes&nbsp;:&nbsp;<span style="color:#2B91AF;">Form</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;Quakes() <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InitializeComponent(); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Set&nbsp;defaults</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listBox1.SelectedItem&nbsp;=&nbsp;<span style="color:#A31515;">&quot;1000000&quot;</span>; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listBox2.SelectedItem&nbsp;=&nbsp;<span style="color:#A31515;">&quot;Earth&quot;</span>; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">void</span>&nbsp;buttonExit_Click(<span style="color:blue;">object</span>&nbsp;sender,&nbsp;<span style="color:#2B91AF;">EventArgs</span>&nbsp;e) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dispose(<span style="color:blue;">true</span>); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">void</span>&nbsp;buttonBrowse_Click(<span style="color:blue;">object</span>&nbsp;sender,&nbsp;<span style="color:#2B91AF;">EventArgs</span>&nbsp;e) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(openFileDialog1.ShowDialog()&nbsp;==&nbsp;DialogResult.OK) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;richFilename.Text&nbsp;=&nbsp;openFileDialog1.FileName; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Add&nbsp;messages&nbsp;to&nbsp;the&nbsp;list&nbsp;box</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">void</span>&nbsp;addMessage(<span style="color:blue;">string</span>&nbsp;m) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">int</span>&nbsp;i&nbsp;=&nbsp;richMessages.Items.Add(m); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;richMessages.SelectedIndex&nbsp;=&nbsp;i; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Go!</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">void</span>&nbsp;buttonGo_Click(<span style="color:blue;">object</span>&nbsp;sender,&nbsp;<span style="color:#2B91AF;">EventArgs</span>&nbsp;e) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;line; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;w; <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;richMessages.Items.Clear(); <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">try</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initWWTLayer();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2B91AF;">StreamReader</span>&nbsp;sr&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2B91AF;">StreamReader</span>(richFilename.Text); <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Ignore&nbsp;first&nbsp;line&nbsp;of&nbsp;data&nbsp;(the&nbsp;headings)</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;sr.ReadLine(); <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Read&nbsp;lines&nbsp;of&nbsp;data&nbsp;until&nbsp;there&nbsp;are&nbsp;none&nbsp;left</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">while</span>&nbsp;((w&nbsp;=&nbsp;sr.ReadLine())&nbsp;!=&nbsp;<span style="color:blue;">null</span>) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=&nbsp;parseLine(w,<span style="color:blue;">false</span>); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flushBufferToWWT(line); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sr.Close(); <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Flush&nbsp;buffer&nbsp;for&nbsp;last&nbsp;time&nbsp;-&nbsp;empty&nbsp;string&nbsp;indicates&nbsp;this&nbsp;is&nbsp;the&nbsp;last&nbsp;flush</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flushBufferToWWT(<span style="color:#A31515;">&quot;&quot;</span>); <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Record&nbsp;the&nbsp;end</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addMessage(<span style="color:#A31515;">&quot;Data&nbsp;transmission&nbsp;ended:&nbsp;&quot;</span>&nbsp;+&nbsp;totalEvents&nbsp;+&nbsp;<span style="color:#A31515;">&quot;&nbsp;events&quot;</span>); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">catch</span>&nbsp;(<span style="color:#2B91AF;">Exception</span>&nbsp;ex) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addMessage(ex.Message); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Change&nbsp;the&nbsp;event&nbsp;color</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">void</span>&nbsp;buttonColor_Click(<span style="color:blue;">object</span>&nbsp;sender,&nbsp;<span style="color:#2B91AF;">EventArgs</span>&nbsp;e) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(colorDialog.ShowDialog()&nbsp;==&nbsp;DialogResult.OK) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buttonColor.BackColor&nbsp;=&nbsp;colorDialog.Color; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">int</span>&nbsp;timeSlot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Data&nbsp;column&nbsp;number&nbsp;for&nbsp;time</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">int</span>&nbsp;latSlot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Data&nbsp;column&nbsp;number&nbsp;for&nbsp;latitude</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">int</span>&nbsp;lonSlot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Data&nbsp;column&nbsp;number&nbsp;for&nbsp;longitude</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">int</span>&nbsp;depSlot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Data&nbsp;column&nbsp;number&nbsp;for&nbsp;depth</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">int</span>&nbsp;magSlot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Data&nbsp;column&nbsp;number&nbsp;for&nbsp;magnitude</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;layerId;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;string&nbsp;GUID&nbsp;for&nbsp;the&nbsp;WWT&nbsp;Layer</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;lineBuffer;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Buffer&nbsp;to&nbsp;hold&nbsp;events&nbsp;until&nbsp;they&nbsp;are&nbsp;sent</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">int</span>&nbsp;lineCountInBuffer;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Number&nbsp;of&nbsp;events&nbsp;in&nbsp;the&nbsp;buffer</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">int</span>&nbsp;totalEvents;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Count&nbsp;of&nbsp;total&nbsp;events&nbsp;transmitted</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DateTime&nbsp;lastTimeBufferFlushed;&nbsp;<span style="color:green;">//&nbsp;Time&nbsp;of&nbsp;last&nbsp;transmission,&nbsp;used&nbsp;to&nbsp;check&nbsp;for&nbsp;time-out</span> <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Locate&nbsp;the&nbsp;columns&nbsp;of&nbsp;the&nbsp;required&nbsp;data,&nbsp;they&nbsp;must&nbsp;be&nbsp;present&nbsp;but&nbsp;can&nbsp;be&nbsp;in&nbsp;any</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;order&nbsp;in&nbsp;the&nbsp;data&nbsp;file</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">string</span>&nbsp;initCSVData(<span style="color:blue;">string</span>&nbsp;filename) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;w;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;line&nbsp;of&nbsp;data&nbsp;from&nbsp;data&nbsp;file</span> <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timeSlot&nbsp;=&nbsp;-1; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latSlot&nbsp;=&nbsp;-1; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lonSlot&nbsp;=&nbsp;-1; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depSlot&nbsp;=&nbsp;-1; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;magSlot&nbsp;=&nbsp;-1; <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;First&nbsp;line&nbsp;(line&nbsp;0)&nbsp;of&nbsp;the&nbsp;data&nbsp;file&nbsp;must&nbsp;contain&nbsp;the&nbsp;column&nbsp;headings</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2B91AF;">StreamReader</span>&nbsp;sr&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2B91AF;">StreamReader</span>(filename); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;sr.ReadLine(); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>[]&nbsp;words&nbsp;=&nbsp;w.Split(<span style="color:blue;">new</span>&nbsp;<span style="color:blue;">char</span>[]&nbsp;{&nbsp;<span style="color:#A31515;">&#39;,&#39;</span>&nbsp;}); <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">for</span>&nbsp;(<span style="color:blue;">int</span>&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;words.Length;&nbsp;i++) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(words[i].IndexOf(<span style="color:#A31515;">&quot;Time&quot;</span>,&nbsp;StringComparison.OrdinalIgnoreCase)&nbsp;!=&nbsp;-1) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timeSlot&nbsp;=&nbsp;i; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">else</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(words[i].IndexOf(<span style="color:#A31515;">&quot;Lat&quot;</span>,&nbsp;StringComparison.OrdinalIgnoreCase)&nbsp;!=&nbsp;-1) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latSlot&nbsp;=&nbsp;i; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">else</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(words[i].IndexOf(<span style="color:#A31515;">&quot;Lon&quot;</span>,&nbsp;StringComparison.OrdinalIgnoreCase)&nbsp;!=&nbsp;-1) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lonSlot&nbsp;=&nbsp;i; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">else</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(words[i].IndexOf(<span style="color:#A31515;">&quot;Depth&quot;</span>,&nbsp;StringComparison.OrdinalIgnoreCase)&nbsp;!=&nbsp;-1) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depSlot&nbsp;=&nbsp;i; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">else</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(words[i].IndexOf(<span style="color:#A31515;">&quot;Mag&quot;</span>,&nbsp;StringComparison.OrdinalIgnoreCase)&nbsp;!=&nbsp;-1) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;magSlot&nbsp;=&nbsp;i; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;One&nbsp;of&nbsp;more&nbsp;heading&nbsp;is&nbsp;missing....</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(timeSlot&nbsp;==&nbsp;-1&nbsp;||&nbsp;latSlot&nbsp;==&nbsp;-1&nbsp;||&nbsp;lonSlot&nbsp;==&nbsp;-1&nbsp;||&nbsp;depSlot&nbsp;==&nbsp;-1&nbsp;||&nbsp;magSlot&nbsp;==&nbsp;-1) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">throw</span>&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2B91AF;">Exception</span>(<span style="color:#A31515;">&quot;Source&nbsp;file&nbsp;does&nbsp;not&nbsp;contain&nbsp;one&nbsp;or&nbsp;more&nbsp;of:&nbsp;time,&nbsp;lat,&nbsp;lon,&nbsp;depth,&nbsp;mag&quot;</span>); <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Record&nbsp;a&nbsp;successful&nbsp;reading&nbsp;of&nbsp;the&nbsp;headings</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addMessage(<span style="color:#A31515;">&quot;Time&nbsp;=&nbsp;&quot;</span>&nbsp;+&nbsp;timeSlot.ToString()&nbsp;+&nbsp;<span style="color:#A31515;">&quot;&nbsp;Lat&nbsp;=&nbsp;&quot;</span>&nbsp;+&nbsp;latSlot.ToString()&nbsp;+&nbsp;<span style="color:#A31515;">&quot;&nbsp;Lon&nbsp;=&nbsp;&quot;</span>&nbsp;+&nbsp;lonSlot.ToString()&nbsp;+&nbsp;<span style="color:#A31515;">&quot;&nbsp;Depth&nbsp;=&nbsp;&quot;</span>&nbsp;+&nbsp;depSlot.ToString()&nbsp;+&nbsp;<span style="color:#A31515;">&quot;&nbsp;Mag&nbsp;=&nbsp;&quot;</span>&nbsp;+&nbsp;magSlot.ToString()); <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Extract&nbsp;the&nbsp;start&nbsp;time&nbsp;from&nbsp;the&nbsp;data&nbsp;file&nbsp;by&nbsp;reading&nbsp;line&nbsp;1</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">// </span> <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;sr.ReadLine(); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;startDate&nbsp;=&nbsp;parseLine(w,&nbsp;<span style="color:blue;">true</span>); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sr.Close(); <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Record&nbsp;a&nbsp;successful&nbsp;reading&nbsp;of&nbsp;the&nbsp;start</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addMessage(<span style="color:#A31515;">&quot;Start&nbsp;time&nbsp;=&nbsp;&quot;</span>&nbsp;+&nbsp;startDate);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;startDate; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Convert&nbsp;a&nbsp;string&nbsp;time&nbsp;to&nbsp;the&nbsp;correct&nbsp;format</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">string</span>&nbsp;convertTimeData(<span style="color:blue;">string</span>&nbsp;time) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DateTime&nbsp;d&nbsp;=&nbsp;DateTime.Parse(time); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;s&nbsp;=&nbsp;d.ToUniversalTime().ToString(); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;s; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Parses&nbsp;a&nbsp;line&nbsp;from&nbsp;the&nbsp;data&nbsp;file</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">string</span>&nbsp;parseLine(<span style="color:blue;">string</span>&nbsp;w,&nbsp;<span style="color:blue;">bool</span>&nbsp;timeOnly) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>[]&nbsp;words&nbsp;=&nbsp;w.Split(<span style="color:blue;">new</span>&nbsp;<span style="color:blue;">char</span>[]&nbsp;{&nbsp;<span style="color:#A31515;">&#39;,&#39;</span>&nbsp;}); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;line&nbsp;=&nbsp;<span style="color:#A31515;">&quot;&quot;</span>; <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;time&nbsp;=&nbsp;convertTimeData(words[timeSlot]); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;lat&nbsp;=&nbsp;words[latSlot]; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;lon&nbsp;=&nbsp;words[lonSlot]; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;depth&nbsp;=&nbsp;words[depSlot]; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;mag&nbsp;=&nbsp;words[magSlot]; <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(timeOnly) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;time; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=&nbsp;time&nbsp;+&nbsp;<span style="color:#A31515;">&quot;\t&quot;</span>&nbsp;+&nbsp;lat&nbsp;+&nbsp;<span style="color:#A31515;">&quot;\t&quot;</span>&nbsp;+&nbsp;lon&nbsp;+&nbsp;<span style="color:#A31515;">&quot;\t&quot;</span>&nbsp;+&nbsp;depth&nbsp;+&nbsp;<span style="color:#A31515;">&quot;\t&quot;</span>&nbsp;+&nbsp;mag&nbsp;+&nbsp;<span style="color:#A31515;">&quot;\t&quot;</span>; <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;line; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Create&nbsp;a&nbsp;new&nbsp;WWT&nbsp;layer</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">void</span>&nbsp;<a name="initWWTLayer">initWWTLayer</a>() <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Send&nbsp;a&nbsp;NEW&nbsp;command,&nbsp;extracting&nbsp;info&nbsp;from&nbsp;the&nbsp;data&nbsp;file&nbsp;and&nbsp;the&nbsp;UI</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WebClient&nbsp;client&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;WebClient(); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;startDate&nbsp;=&nbsp;initCSVData(richFilename.Text); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;name&nbsp;=&nbsp;<span style="color:#2B91AF;">Path</span>.GetFileNameWithoutExtension(richFilename.Text); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;rate&nbsp;=&nbsp;listBox1.SelectedItem.ToString(); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;frame&nbsp;=&nbsp;listBox2.SelectedItem.ToString(); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;color&nbsp;=&nbsp;buttonColor.BackColor.A.ToString(<span style="color:#A31515;">&quot;X2&quot;</span>)&nbsp;+&nbsp;buttonColor.BackColor.R.ToString(<span style="color:#A31515;">&quot;X2&quot;</span>)&nbsp;+&nbsp;buttonColor.BackColor.G.ToString(<span style="color:#A31515;">&quot;X2&quot;</span>)&nbsp;+&nbsp;buttonColor.BackColor.B.ToString(<span style="color:#A31515;">&quot;X2&quot;</span>); <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;url&nbsp;=&nbsp;<span style="color:blue;">string</span>.Format(<span style="color:#A31515;">&quot;http://{0}:5050/layerApi.aspx?cmd=new&datetime={1}&timerate={2}&name={3}&frame={4}&color={5}&quot;</span>,&nbsp;&nbsp;GetIp().ToString(),&nbsp;startDate,&nbsp;rate,&nbsp;name,&nbsp;frame,&nbsp;color); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;field&nbsp;string&nbsp;below&nbsp;is&nbsp;delimited&nbsp;by&nbsp;tabs,&nbsp;not&nbsp;spaces</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;response&nbsp;=&nbsp;client.UploadString(url,&nbsp;<span style="color:#A31515;">&quot;TIME&nbsp;&nbsp;&nbsp;&nbsp;LAT&nbsp;&nbsp;&nbsp;&nbsp;LON&nbsp;&nbsp;&nbsp;&nbsp;DEPTH&nbsp;&nbsp;&nbsp;&nbsp;MAG&quot;</span>); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlDocument&nbsp;doc&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;XmlDocument(); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.LoadXml(response); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlNode&nbsp;node&nbsp;=&nbsp;doc[<span style="color:#A31515;">&quot;LayerApi&quot;</span>]; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlNode&nbsp;child&nbsp;=&nbsp;node.ChildNodes[0]; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;layerId&nbsp;=&nbsp;child.InnerText; <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Handle&nbsp;an&nbsp;error&nbsp;situation</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(layerId.Length&nbsp;!=&nbsp;36) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">throw</span>&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2B91AF;">Exception</span>(<span style="color:#A31515;">&quot;Invalid&nbsp;Layer&nbsp;Id&nbsp;received&quot;</span>); <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Record&nbsp;a&nbsp;successful&nbsp;creation&nbsp;of&nbsp;a&nbsp;new&nbsp;layer</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addMessage(<span style="color:#A31515;">&quot;New&nbsp;layer&nbsp;Id&nbsp;=&nbsp;&quot;</span>&nbsp;+&nbsp;layerId); <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Clear&nbsp;the&nbsp;buffer</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lineBuffer&nbsp;=&nbsp;<span style="color:blue;">string</span>.Empty; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lineCountInBuffer&nbsp;=&nbsp;0; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;totalEvents&nbsp;=&nbsp;0; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lastTimeBufferFlushed&nbsp;=&nbsp;DateTime.Now; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Utility&nbsp;to&nbsp;extract&nbsp;IP&nbsp;address</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPAddress&nbsp;GetIp() <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPAddress&nbsp;ipAddress&nbsp;=&nbsp;IPAddress.Loopback; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Find&nbsp;IPV4&nbsp;Address</span> <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">foreach</span>&nbsp;(IPAddress&nbsp;ipAdd&nbsp;<span style="color:blue;">in</span>&nbsp;Dns.GetHostEntry(Dns.GetHostName()).AddressList) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(ipAdd.AddressFamily&nbsp;==&nbsp;AddressFamily.InterNetwork) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipAddress&nbsp;=&nbsp;ipAdd; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">break</span>; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;ipAddress; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Buffer&nbsp;the&nbsp;data&nbsp;and&nbsp;send&nbsp;it&nbsp;to&nbsp;WWT&nbsp;every&nbsp;N&nbsp;events&nbsp;or&nbsp;every&nbsp;T&nbsp;time&nbsp;units</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">void</span>&nbsp;<a name="flushBufferToWWT">flushBufferToWWT</a>(<span style="color:blue;">string</span>&nbsp;line) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">const</span>&nbsp;<span style="color:blue;">int</span>&nbsp;FlushThresholdInEventCount&nbsp;=&nbsp;100;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Flush&nbsp;the&nbsp;buffer&nbsp;when&nbsp;this&nbsp;number&nbsp;of&nbsp;events&nbsp;is&nbsp;stored</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">const</span>&nbsp;<span style="color:blue;">int</span>&nbsp;FlushThresholdInSeconds&nbsp;=&nbsp;2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Flush&nbsp;the&nbsp;buffer&nbsp;after&nbsp;this&nbsp;number&nbsp;of&nbsp;seconds&nbsp;has&nbsp;elapsed</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;If&nbsp;line&nbsp;length&nbsp;is&nbsp;zero,&nbsp;this&nbsp;is&nbsp;the&nbsp;last&nbsp;transmission</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(line.Length&nbsp;&gt;&nbsp;0) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lineBuffer&nbsp;=&nbsp;lineBuffer&nbsp;+&nbsp;line&nbsp;+&nbsp;Environment.NewLine; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lineCountInBuffer++; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DateTime&nbsp;now&nbsp;=&nbsp;DateTime.Now; <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Send&nbsp;the&nbsp;buffer&nbsp;if&nbsp;flushing&nbsp;for&nbsp;the&nbsp;last&nbsp;time&nbsp;OR&nbsp;the&nbsp;buffer&nbsp;is&nbsp;full&nbsp;OR&nbsp;the&nbsp;timeout&nbsp;has&nbsp;been&nbsp;reached</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;((line.Length&nbsp;==&nbsp;0&nbsp;&&&nbsp;lineCountInBuffer&nbsp;&gt;&nbsp;0)&nbsp;|| <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lineCountInBuffer&nbsp;==&nbsp;FlushThresholdInEventCount&nbsp;|| <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now.Subtract(lastTimeBufferFlushed)&nbsp;&gt;&nbsp;TimeSpan.FromSeconds(FlushThresholdInSeconds)) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Send&nbsp;an&nbsp;UPDATE&nbsp;command</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WebClient&nbsp;client&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;WebClient(); <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;url&nbsp;=&nbsp;<span style="color:blue;">string</span>.Format(<span style="color:#A31515;">&quot;http://{0}:5050/layerApi.aspx?cmd=update&id={1}&quot;</span>,&nbsp;GetIp().ToString(),&nbsp;layerId); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;response&nbsp;=&nbsp;client.UploadString(url,&nbsp;lineBuffer); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlDocument&nbsp;doc&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;XmlDocument(); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc.LoadXml(response); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlNode&nbsp;node&nbsp;=&nbsp;doc[<span style="color:#A31515;">&quot;LayerApi&quot;</span>]; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;s&nbsp;=&nbsp;node.InnerText; <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Handle&nbsp;an&nbsp;error&nbsp;situation</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(s.Contains(<span style="color:#A31515;">&quot;Error&quot;</span>)) <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">throw</span>&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2B91AF;">Exception</span>(s); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Record&nbsp;a&nbsp;successful&nbsp;transmission</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addMessage(now.ToString()&nbsp;+&nbsp;<span style="color:#A31515;">&quot;:&nbsp;&quot;</span>&nbsp;+&nbsp;lineCountInBuffer.ToString()&nbsp;+&nbsp;<span style="color:#A31515;">&quot;&nbsp;events&nbsp;sent&quot;</span>); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;totalEvents&nbsp;+=&nbsp;lineCountInBuffer; <br />
 <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Clear&nbsp;the&nbsp;buffer</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//</span> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lineBuffer&nbsp;=&nbsp;<span style="color:blue;">string</span>.Empty; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lastTimeBufferFlushed&nbsp;=&nbsp;now; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lineCountInBuffer&nbsp;=&nbsp;0; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />
&nbsp;&nbsp;&nbsp;&nbsp;} <br />
} <br />
<span style="color:green;">//</span> <br />
<span style="color:green;">//&nbsp;End</span> <br />
<span style="color:green;">//</span>
</span></td></tr></table>




<h4>See Also</h4>
<ul type="disc">
	<li><a href="#LCAPI_Commands">Layer API commands</a></li>
	<li><a href="#WorldWideTelescopeLooselyCoupledAPI">WorldWide Telescope 
	Loosely Coupled API</a></li>
</ul>


</body>
</html>
